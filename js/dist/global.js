var slugify=function(a){return a.toString().trim().toLowerCase().replace(/\s+/g,'-').replace(/[^\w\-]+/g,'').replace(/\-\-+/g,'-').replace(/^-+/,'').replace(/-+$/,'')},typeCompanies=function(a){return a.profit=+a.profit,a.rate=+a.rate,a.years_no_tax=+a.years_no_tax,a.tax_break=+a.tax_break,a},typeComparisons=function(a){return a.money=+a.money,a};let createProportionAreas=function(a,b,c,d){var e=Math.floor;let f,g=0.35*b/d,h=e(g),i=c/d,j=e(i),k=g-i,l=h-j;f=1e3==d?'1 billion':100==d?'100 million':10==d?'10 million':'1 million';let m=[{text:'If the 35% tax rate was paid, it would be ',numSquares:h,color:'rgba(0, 39, 0, 0.8)',money:getMoneyString(g,d),unit:f}];0>k?m.unshift({text:'Tax breaks totaled ',numSquares:j,color:'rgba(0, 98, 0, 1)',money:getMoneyString(i,d),unit:f}):l>h?m.unshift({text:'Taxes paid totaled ',numSquares:l,color:'rgba(0, 137, 0, 1)',money:getMoneyString(k,d),unit:f}):m.push({text:'Taxes paid totaled ',numSquares:l,color:'rgba(0, 137, 0, 1)',money:getMoneyString(k,d),unit:f});let n=0,o=0;for(let f in a){let b=a[f],c=b.money/d,g=e(c);isWholeComparison(b,j,g,n)&&(m.push({text:b.text,numSquares:g,color:b.color,money:getMoneyString(c,d)}),n+=g,o=f)}let p=j-n,q=parseInt(o)+1,r=a[q];for(;0<p&&q<a.length;){let b=r.money/d,c=e(p/b),f=Math.ceil(b*c);0<c&&(m.push({text:c+' x '+r.text,numSquares:f,color:r.color,money:getMoneyString(b*c,d)}),p-=f),q++,r=a[q]}return m},getMoneyString=function(a,b){let c,d;return a*=b,d=Math.floor(Math.log10(a)),5<d?(c=' trillion',a/=1e6):2<d?(c=' billion',a/=1e3):c=' million',a.toFixed(1)+''+c};var isWholeComparison=function(a,b,c,d){return 4<c&&c<=b-d};let allCompanyData,currentCompany,inMapMode=!1,proportionInTransition=!1,dynamicTextInProgress=!1,openingScreenTimeouts=[],allRegionsDrawn=!0,infoBoxData={},comparisonData={},totalProfits=0,totalTaxBreaks=0,currentSlide=1,shouldFade=!1,companyNames=['All companies'],companiesIPS=[],companiesCompUp=[],companiesYearsNoTax={1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[]},companiesTop25=[],companiesRebates={stockOptions:[],researchExperiment:[],dpad:[],deferredTaxes:[],accDepreciation:[]},companies92=[],companiesTop3EmpChanges={1:[],2:[],3:[]},companiesLostEmployees=[],companiesForeignDiff=[],companiesCompetitors={1:[],2:[],3:[],4:[],5:[]};d3.queue().defer(d3.csv,'csv/dv_data/interactive_data.csv',typeCompanies).defer(d3.csv,'csv/dv_data/comparison_data.csv',typeComparisons).await(function(a,b,c){allCompanyData=b,b.map(function(a){var b=slugify(a.company_name);infoBoxData[b]={companyName:a.company_name,profit:a.profit,rate:a.rate,industry:a.industry,yearsNoTax:a.years_no_tax,note:a.note,taxBreak:getMoneyString(a.tax_break,1),stockOptions:a.stock_options,researchExperiment:a.research_experiment,dpad:a.dpad,accDepreciation:a.acc_depreciation,deferredTaxes:a.deferred_taxes},companyNames.push(a.company_name),''!=a.ceo_comp_change&&companiesIPS.push(a);var d=a.years_no_tax;'0'!=d&&companiesYearsNoTax[d].push(a),'True'==a.top25&&companiesTop25.push(a),'True'==a.stock_options&&companiesRebates.stockOptions.push(a),'True'==a.research_experiment&&companiesRebates.researchExperiment.push(a),'True'==a.dpad&&companiesRebates.dpad.push(a),'True'==a.acc_depreciation&&companiesRebates.accDepreciation.push(a),'True'==a.deferred_taxes&&companiesRebates.deferredTaxes.push(a);var e=a.top3_emp_changes;'0'!=e&&companiesTop3EmpChanges[e].push(a),0>a.diff_emp_count&&(companiesLostEmployees.push(a),0<a.ceo_comp_change&&companiesCompUp.push(a)),''!=a.us_foreign_diff&&companiesForeignDiff.push(a);var f=a.competitor;'0'!=f&&(0<companiesCompetitors[f].length?a.rate>companiesCompetitors[f][0].rate?companiesCompetitors[f].unshift(a):companiesCompetitors[f].push(a):companiesCompetitors[f].push(a));let g=Math.pow(10,Math.floor(Math.log10(a.profit))-3);1>g&&(g=1),comparisonData[a.company_name]=createProportionAreas(c,a.profit,a.tax_break,g,a.company_name),totalProfits+=a.profit,totalTaxBreaks+=a.tax_break});let d=(100*((0.35*totalProfits-totalTaxBreaks)/totalProfits)).toFixed(2);comparisonData['All Companies']=createProportionAreas(c,totalProfits,totalTaxBreaks,1e3),infoBoxData[slugify('All Companies')]={companyName:'All Companies',profit:totalProfits,rate:d,industry:'',yearsNoTax:'',note:'',taxBreak:getMoneyString(totalTaxBreaks,1),stockOptions:'True',researchExperiment:'True',dpad:'True',accDepreciation:'True',deferredTaxes:'True'},populateDropdown(companyNames),createSlides(b,companiesYearsNoTax,companiesTop25,companiesRebates,companiesIPS,companiesTop3EmpChanges,companiesLostEmployees,companiesCompUp,companiesForeignDiff,companiesCompetitors)});