var updateBarGraphText=function(a){var b=barGraphParams.barGraphWidth,c=barGraphParams.barGraphHeight,d=barGraphParams.barGraphTextValue,e=barGraphParams.barGraphTextX,f=d3.select('.bar-graph-text'),g=d3.select('.bar-graph-text-arrow'),h=f;return new Promise(function(i){f.attr('x',b*e).text(function(){if(d)return d}).style('font-size',function(){return'Click to continue'==d?'2vw':'1vw'});var j=f.node().getBBox().width;'Click to continue'==d&&(g.attr('x',b*e+j).attr('y',f.attr('y')-0.5*f.node().getBBox().height).style('width',0.02*b).style('height',0.02*c),h=d3.selectAll('.bar-graph-text, .bar-graph-text-arrow')),h.transition().duration(a).ease(d3.easeLinear).style('opacity',1).end(i)})},hideBarGraphText=function(a){var b=barGraphParams.barGraphWidth,c=d3.selectAll('.bar-graph-text, .bar-graph-text-arrow');return new Promise(function(b){c.transition().duration(a).ease(d3.easeLinear).style('opacity',0).end(b)})},updateXScale=function(){var a=barGraphParams.barGraphWidth;barGraphParams.x=d3.scaleBand().range([0,a])},updateYScale=function(){var a=barGraphParams.domainStart,b=barGraphParams.domainEnd,c=barGraphParams.barGraphHeight;barGraphParams.y=d3.scaleLinear().domain([a,b]).range([c,0])},updatePercentLine=function(a){return new Promise(function(b){var c=barGraphParams.barGraphWidth,d=barGraphParams.y,e=d3.select('.percent-line');0!=e.style('opacity')||inMapMode?e.transition().duration(a).ease(d3.easeLinear).attr('x1',0).attr('x2',c).attr('y1',d(35)).attr('y2',d(35)).end(b):e.style('opacity',1).attr('x1',0).attr('x2',0).attr('y1',d(35)).attr('y2',d(35)).transition().duration(a).attr('x2',c).end(b)})},updateXAxis=function(a,b){return new Promise(function(c){var d=barGraphParams.data,e=barGraphParams.x,f=barGraphParams.y,g=barGraphParams.yParam,h=d.slice(0).sort(function(c,a){return a[g]-c[g]});e.domain(h.map(function(a){return a.company_name}));var i=d3.axisBottom().tickFormat('').tickSize(0).scale(e);d3.select('.x-axis').transition().duration(a).ease(d3.easeLinear).attr('transform','translate(0,'+f(0)+')').style('opacity',function(){return b?0:1}).call(i).end(c)})},updateYAxis=function(a,b){return new Promise(function(c){var d=barGraphParams.y,e=barGraphParams.tickValues,f=barGraphParams.axisEnding,g=d3.axisLeft().tickValues(e).tickFormat(function(a){return a+f}).tickSize(0).scale(d);d3.select('.y-axis').transition().duration(a).ease(d3.easeLinear).call(g).style('opacity',function(){return b?0:1}).end(c)})},updateBars=function(a,b,c){return new Promise(function(d){var e=barGraphParams.data,f=barGraphParams.x,g=barGraphParams.y,h=barGraphParams.yParam,i=d3.select('.bar-graph-elements'),j=i.selectAll('.bar').data(e,function(a){return a.company_name});Promise.all([function(){return new Promise(function(b){j.exit().transition().duration(a).ease(d3.easeLinear).attr('y',g(0)).attr('height',0).remove().end(b)})}(),function(){return new Promise(function(a){j.enter().append('rect').attr('class',function(a){return'bar '+slugify(a.company_name)}).on('mouseover',function(a){inMapMode&&allRegionsDrawn&&a!=currentCompany&&(updateCompanyLabel(300,a.company_name),d3.select(this).style('fill','yellow').style('stroke','yellow'))}).on('mouseout',function(a){if(inMapMode&&allRegionsDrawn&&a!=currentCompany){updateCompanyLabel(300,'');var b;b=35<a.rate?'rgba(0,0,0,0.4)':'#0FEA00',d3.select(this).style('fill',b).style('stroke','black')}}).on('click',function(a){if(inMapMode&&allRegionsDrawn){currentCompany=a,d3.selectAll('.bar').style('fill',function(a){return 35<a.rate?'rgba(0,0,0,0.4)':'#0FEA00'}),d3.select(this).style('fill','yellow').style('stroke','black');var b=a.company_name;openMapView(allCompanyData,b)}}).call(updateBarSize).style('opacity',0).transition().duration(b).ease(d3.easeLinear).style('opacity',1).end(function(){a()})})}(),function(){return new Promise(function(b){j.transition().delay(a).duration(c).ease(d3.easeLinear).call(updateBarSize).end(function(){b()})})}()]).then(d)})},updateBarSize=function(a){var b=barGraphParams.x,c=barGraphParams.y,e=barGraphParams.yParam,d=barGraphParams.barGraphWidth,f=barGraphParams.data;a.attr('x',function(a){return b(a.company_name)}).attr('y',function(a){return 0<a[e]?c(a[e]):c(0)}).style('stroke','black').style('stroke-width',0.5).attr('width',d/(f.length+100)).attr('height',function(a){return Math.abs(c(a[e])-c(0))})},updateBarGraphParam=function(a,b){return new Promise(function(c){barGraphParams[a]=b,c()})},updateBarGraphSVG=function(a){var b=barGraphParams.totalWidth,c=barGraphParams.totalHeight;d3.select('.bar-graph').transition().duration(a).ease(d3.easeLinear).attr('width',b).attr('height',c)},updateCompanyLabel=function(a){var b=void 0===arguments[1]?null:arguments[1],c=void 0===arguments[2]?5:arguments[2],d=void 0===arguments[3]?-20:arguments[3],e=barGraphParams.y;return new Promise(function(f){d3.select('.company-label').attr('x',c).attr('y',e(d)).transition().duration(300).style('opacity',0).transition().duration(a).ease(d3.easeLinear).call(function(a){null!=b&&a.text(b)}).style('opacity',1).end(f)})},updateBarGraphDims=function(a){var b=barGraphParams.marginTop,c=barGraphParams.marginRight,d=barGraphParams.marginLeft,e=barGraphParams.marginBottom,f=$('.bar-graph-viewer').width()-d-c;a||(a=$('.bar-graph-viewer').height());var g=a-b-e;updateBarGraphParam('barGraphWidth',f),updateBarGraphParam('barGraphHeight',g),updateBarGraphParam('totalWidth',f+d+c),updateBarGraphParam('totalHeight',g+b+e)},restartSlide=function(a){fadeAll(a).then(function(){showAll(a),slideInProgress=!1,currentSlide-=1,$('.bar-graph-viewer').trigger('click')})},updateBarGraphYLabel=function(a,b){var c=barGraphParams.marginLeft,d=barGraphParams.barGraphHeight,e=barGraphParams.yParam;b&&(e=null);var f={rate:'Effective Tax Rate (2008-2015)',tax_break:'Total Tax Break (2008-2015)',adjusted_emp_change:'Adjusted change in employees (% 2008-2016)',us_foreign_diff:'US tax rate - Foreign tax rate'};return new Promise(function(g){d3.select('.y-label').text()==f[e]?(d3.select('.y-label').attr('transform','translate('+-0.5*c+','+0.5*d+')rotate(-90)').text(f[e]),g()):(console.log(e),d3.select('.y-label').attr('transform','translate('+-0.5*c+','+0.5*d+')rotate(-90)').style('opacity',0).text(function(){return b?b:f[e]}).transition().duration(a).style('opacity',1).end(function(){g()}))})},hideBarGraphYLabel=function(a){return new Promise(function(b){d3.select('.y-label').transition().duration(a).style('opacity',0).end(b)})};